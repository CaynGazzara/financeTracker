<div class="form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        {{ isEditMode ? 'Editar Transação' : 'Nova Transação' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="isLoading" class="loading-spinner">
        <mat-spinner></mat-spinner>
        <p>Carregando categorias...</p>
      </div>

      <form *ngIf="!isLoading" [formGroup]="transactionForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descrição</mat-label>
            <input matInput formControlName="description" placeholder="Ex: Salário, Mercado, etc.">
            <mat-error *ngIf="transactionForm.get('description')?.hasError('required')">
              Descrição é obrigatória
            </mat-error>
            <mat-error *ngIf="transactionForm.get('description')?.hasError('minlength')">
              Descrição deve ter pelo menos 3 caracteres
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Valor</mat-label>
            <input matInput type="number" formControlName="amount" placeholder="0,00" min="0.01" step="0.01">
            <span matPrefix>R$&nbsp;</span>
            <mat-error *ngIf="transactionForm.get('amount')?.hasError('required')">
              Valor é obrigatório
            </mat-error>
            <mat-error *ngIf="transactionForm.get('amount')?.hasError('min')">
              Valor deve ser maior que zero
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Data</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="date">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="transactionForm.get('date')?.hasError('required')">
              Data é obrigatória
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Tipo</mat-label>
            <mat-select formControlName="type">
              <!-- ✅ Usar valores numéricos -->
              <mat-option [value]="0">Receita</mat-option>
              <mat-option [value]="1">Despesa</mat-option>
            </mat-select>
            <mat-error *ngIf="transactionForm.get('type')?.hasError('required')">
              Tipo é obrigatório
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Categoria</mat-label>
            <mat-select formControlName="categoryId">
              <mat-option *ngFor="let category of filteredCategories" [value]="category.id">
                <span class="category-option">
                  <span class="color-dot" [style.background-color]="category.color"></span>
                  {{ category.name }}
                </span>
              </mat-option>
            </mat-select>
            <mat-error *ngIf="transactionForm.get('categoryId')?.hasError('required')">
              Categoria é obrigatória
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button type="button" mat-button (click)="onCancel()">
            Cancelar
          </button>
          <button type="submit" mat-raised-button color="primary" [disabled]="!transactionForm.valid">
            {{ isEditMode ? 'Atualizar' : 'Criar' }} Transação
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>